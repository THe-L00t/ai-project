# Claude Code 프롬프트 & 워크플로우 관리

## 🎯 프로젝트 목표 요약
- **프로젝트**: 코인 자동매매 AI 시스템
- **초기 자금**: 10만원
- **목표**: 월 10% 수익률 달성
- **전략**: 스캘핑 + AI 자동 코인 선택
- **개발 환경**: Python 3.10, 업비트 API, Random Forest + 강화학습

---

## 📋 Phase별 Claude Code 프롬프트

### Phase 1: 기반 구축 (1주) 🏗️

#### 1-1. 프로젝트 구조 생성
```
프로젝트 디렉토리: /Users/the-l00t/Project/CoinTradingAI

다음 구조로 프로젝트를 생성해줘:

CoinTradingAI/
├── src/
│   ├── __init__.py
│   ├── data/
│   │   ├── __init__.py
│   │   ├── collector.py          # 데이터 수집
│   │   ├── preprocessor.py       # 전처리
│   │   └── storage.py            # 데이터 저장
│   ├── models/
│   │   ├── __init__.py
│   │   ├── random_forest_model.py
│   │   ├── reinforcement_model.py
│   │   └── ensemble.py
│   ├── trading/
│   │   ├── __init__.py
│   │   ├── upbit_api.py          # 업비트 API
│   │   ├── strategy.py           # 거래 전략
│   │   └── risk_manager.py       # 리스크 관리
│   ├── backtesting/
│   │   ├── __init__.py
│   │   ├── engine.py
│   │   └── metrics.py
│   └── utils/
│       ├── __init__.py
│       ├── logger.py
│       ├── config.py
│       └── indicators.py         # 기술적 지표
├── data/                         # 데이터 저장소
├── logs/                         # 로그 파일
├── tests/                        # 테스트 파일
├── notebooks/                    # 분석용 주피터 노트북
├── config/
│   ├── settings.py
│   └── .env.example
├── requirements.txt
├── README.md
└── main.py

requirements.txt에는 다음 라이브러리 포함:
- pandas
- numpy
- scikit-learn
- ccxt
- python-dotenv
- PyJWT
- requests
- ta
- plotly
- sqlite3

각 __init__.py 파일도 생성하고, main.py에는 기본 실행 구조만 만들어줘.
```

#### 1-2. 기본 설정 파일 생성
```
config/settings.py 파일을 만들어줘. 다음 설정들을 포함해야 해:

- 거래 설정:
  * 초기 자금: 100,000원
  * 거래당 최대 투자 비율: 20%
  * 손절매: -5%
  * 익절매: 15%
  * 트레일링 스톱: 3%
  * 일일 최대 손실: 15%

- API 설정:
  * 업비트 API 엔드포인트
  * 요청 제한: 분당 100회
  * 데이터 갱신 주기: 60초

- AI 모델 설정:
  * Random Forest 파라미터
  * 재학습 주기: 주간
  * 백테스팅 기간: 24개월

- 리스크 관리:
  * 연속 손실 제한: 3회
  * 시장 급락 임계값: 10%
  * 긴급 정지 조건들

.env.example 파일도 만들어서 API 키 템플릿을 제공해줘.
```

#### 1-3. 업비트 API 기본 연동
```
src/trading/upbit_api.py 파일을 구현해줘.

기능 요구사항:
1. JWT 토큰 기반 인증
2. 계좌 정보 조회
3. 현재가 조회 (단일/복수 코인)
4. 캔들 데이터 조회 (1분, 5분, 1시간, 일봉)
5. 주문하기 (시장가 매수/매도)
6. 주문 조회/취소
7. API 요청 제한 관리 (분당 100회)
8. 에러 핸들링 및 재시도 로직

보안 요구사항:
- .env 파일에서 API 키 로드
- 민감 정보 로깅 방지
- API 키 유효성 검증

테스트 함수도 포함해서 API 연결을 확인할 수 있게 만들어줘.
실제 거래는 하지 않고 조회 기능만 테스트하도록.
```

#### 1-4. 데이터 수집기 구현
```
src/data/collector.py를 구현해줘.

기능:
1. 업비트에서 히스토리 데이터 수집
   - 주요 코인 (BTC, ETH 등) 자동 감지
   - 1분봉부터 일봉까지 다양한 시간대
   - 최대 200개씩 페이지네이션으로 수집

2. 실시간 데이터 수집 준비
   - 1분마다 최신 데이터 업데이트
   - 중복 데이터 방지

3. 데이터 품질 관리
   - 결측치 처리
   - 이상치 탐지
   - 데이터 검증

4. 뉴스 데이터 수집 (RSS 기반)
   - 코인데스크, 블록미디어 등
   - 키워드 기반 필터링
   - 감정 분석을 위한 전처리

SQLite 데이터베이스 스키마도 설계해서 효율적으로 저장할 수 있게 해줘.
```

### Phase 2: AI 모델 개발 (2주) 🤖

#### 2-1. 기술적 지표 계산
```
src/utils/indicators.py를 구현해줘.

스캘핑에 특화된 기술적 지표들:
1. 이동평균 (SMA, EMA) - 5, 10, 20, 50 기간
2. RSI (14, 9 기간)
3. MACD (12, 26, 9)
4. 볼린저 밴드 (20, 2σ)
5. 스토캐스틱 (14, 3, 3)
6. CCI (20 기간)
7. 거래량 지표 (OBV, VWAP)
8. ATR (변동성)
9. 피보나치 되돌림
10. 가격 모멘텀

각 지표는:
- 벡터화된 pandas 연산 사용
- NaN 처리 포함
- 시각화 함수 포함
- 백테스팅에서 사용할 수 있게 최적화

스캘핑에 효과적인 조합 지표도 만들어줘.
```

#### 2-2. Random Forest 모델
```
src/models/random_forest_model.py를 구현해줘.

모델 요구사항:
1. 특성 공학:
   - 기술적 지표 조합
   - 시간별 패턴 (시간대, 요일)
   - 가격 변화율
   - 거래량 패턴
   - 뉴스 감정 점수

2. 타겟 변수:
   - 다음 1시간 내 5% 이상 상승 확률
   - 다음 1시간 내 5% 이상 하락 확률
   - 매수/매도/홀드 신호

3. 모델 구성:
   - RandomForestClassifier 사용
   - 하이퍼파라미터 자동 튜닝 (GridSearch)
   - Cross-validation으로 검증
   - Feature importance 분석

4. 예측 함수:
   - 실시간 예측
   - 신뢰도 점수 포함
   - 앙상블을 위한 확률 출력

오버피팅 방지를 위한 정규화와 검증 로직 포함해줘.
```

#### 2-3. 강화학습 모델 기초
```
src/models/reinforcement_model.py를 구현해줘.

환경 설정:
- State: 기술적 지표 + 포지션 정보 + 시장 상황
- Action: 매수(0~100%), 매도(0~100%), 홀드
- Reward: 수익률 - 리스크 페널티 - 거래 수수료

알고리즘:
- DQN (Deep Q-Network) 사용
- Experience replay
- Target network
- Epsilon-greedy 탐험

모델 구조:
- 입력: 상태 벡터 (기술적 지표 등)
- 출력: 각 액션의 Q값
- 히든 레이어: 2-3층으로 간단하게

훈련:
- 과거 데이터로 시뮬레이션 환경 구성
- 배치 학습으로 안정성 확보
- 성과 지표 실시간 모니터링

이 단계에서는 기본 구조만 만들고, 실제 훈련은 나중에 진행하게 해줘.
```

### Phase 3: 백테스팅 & 전략 (2주) 📊

#### 3-1. 백테스팅 엔진
```
src/backtesting/engine.py를 구현해줘.

핵심 기능:
1. 시뮬레이션 환경:
   - 히스토리 데이터 기반 시뮬레이션
   - 실제 수수료 (0.05%) 반영
   - 슬리피지 (0.5%) 고려
   - 거래 지연 시뮬레이션

2. 포트폴리오 관리:
   - 실시간 자금 추적
   - 포지션 관리
   - 리스크 관리 적용

3. 성과 측정:
   - 총 수익률, 연환산 수익률
   - 샤프 비율, 소르티노 비율
   - 최대 낙폭 (MDD)
   - 승률, 손익비
   - 거래 횟수, 평균 보유기간

4. 시각화:
   - 수익률 곡선
   - 누적 수익률
   - 월별 성과
   - 거래 포인트 표시

다양한 전략을 쉽게 테스트할 수 있는 인터페이스 만들어줘.
```

#### 3-2. 통합 거래 전략
```
src/trading/strategy.py를 구현해줘.

전략 구성:
1. 신호 생성:
   - Random Forest 예측
   - 기술적 지표 확인
   - 뉴스 감정 분석
   - 시장 상황 판단

2. 포지션 사이징:
   - Kelly Criterion 기반
   - 변동성 조정
   - 최대 위험 한도 적용

3. 진입/청산 로직:
   - 다중 조건 확인
   - 트레일링 스톱 구현
   - 시간 기반 청산

4. 리스크 관리:
   - 실시간 손익 모니터링
   - 연속 손실 감지
   - 급락 상황 대응

5. 코인 선택:
   - 뉴스 기반 관심 코인 발굴
   - 거래량/변동성 필터링
   - 동적 포트폴리오 조정

백테스팅에서 검증된 로직만 실거래에 적용하도록 안전장치 포함해줘.
```

### Phase 4: 실시간 시스템 (1주) 🚀

#### 4-1. 실시간 거래 시스템
```
main.py와 실시간 실행 시스템을 구현해줘.

구조:
1. 메인 루프:
   - 1분마다 데이터 업데이트
   - AI 모델 예측 실행
   - 거래 신호 생성
   - 주문 실행

2. 멀티 스레딩:
   - 데이터 수집 스레드
   - 모델 예측 스레드
   - 주문 실행 스레드
   - 모니터링 스레드

3. 안전 모드:
   - 페이퍼 트레이딩 모드
   - 실거래 전환 스위치
   - 긴급 정지 기능

4. 로깅:
   - 모든 거래 기록
   - 에러 로깅
   - 성과 추적

5. 알림:
   - 텔레그램 봇 연동
   - 거래 완료 알림
   - 에러/위험 상황 알림

시스템이 안정적으로 24시간 동작할 수 있게 예외 처리 철저히 해줘.
```

#### 4-2. 모니터링 대시보드
```
간단한 웹 대시보드를 만들어줘 (Flask 사용).

페이지 구성:
1. 실시간 현황:
   - 현재 포트폴리오 상태
   - 실시간 수익률
   - 활성 포지션 목록

2. 성과 분석:
   - 일별/월별 수익률
   - 거래 내역
   - 성과 지표

3. 모델 상태:
   - AI 모델 예측 현황
   - 신뢰도 점수
   - 최근 거래 신호

4. 시스템 상태:
   - API 연결 상태
   - 에러 로그
   - 시스템 리소스

5. 설정:
   - 거래 모드 전환
   - 리스크 설정 조정
   - 긴급 정지

모바일에서도 확인 가능하게 반응형으로 만들어줘.
```

---

## 🔄 워크플로우 관리 가이드

### Claude Code 실행 순서
1. **Phase 1-1** 프로젝트 구조 → **테스트** → **다음 단계**
2. **Phase 1-2** 설정 파일 → **설정 검증** → **다음 단계**
3. **Phase 1-3** API 연동 → **연결 테스트** → **다음 단계**
4. **Phase 1-4** 데이터 수집 → **데이터 확인** → **Phase 2로**

### 각 단계별 검증 포인트
- **코드 품질**: PEP8 준수, 주석, 에러 핸들링
- **보안**: API 키 보호, 로깅 보안
- **성능**: 메모리 사용량, 실행 속도
- **안정성**: 예외 상황 처리, 재시도 로직

### 진행 상황 체크리스트
```
□ Phase 1-1: 프로젝트 구조 생성
□ Phase 1-2: 설정 파일 구현
□ Phase 1-3: 업비트 API 연동
□ Phase 1-4: 데이터 수집기
□ Phase 2-1: 기술적 지표
□ Phase 2-2: Random Forest 모델
□ Phase 2-3: 강화학습 기초
□ Phase 3-1: 백테스팅 엔진
□ Phase 3-2: 거래 전략
□ Phase 4-1: 실시간 시스템
□ Phase 4-2: 모니터링 대시보드
```

### 품질 관리 체크포인트
- 각 Phase 완료 후 단위 테스트 실행
- 백테스팅으로 전략 검증 (목표: 연 50% 수익률)
- 2주간 페이퍼 트레이딩 테스트
- 실거래 전 최종 안전 점검

---

## ⚠️ Claude Code 주의사항

### 보안 최우선
- **절대 API 키를 코드에 하드코딩하지 말 것**
- **.env 파일 사용 필수**
- **로그에서 민감 정보 마스킹**

### 점진적 개발
- **한 번에 모든 기능 구현하지 말고 단계별로**
- **각 단계마다 테스트 후 다음 진행**
- **오류 발생시 이전 단계로 롤백 가능하게**

### 리스크 관리
- **실거래 기능은 마지막에 구현**
- **페이퍼 트레이딩으로 충분한 테스트**
- **긴급 정지 기능 필수**

---

## 📝 Claude 코딩 컨벤션 적용

### PascalCase 네이밍 준수
- **클래스**: `DataCollector`, `UpbitAPI`, `TradingStrategy`
- **함수**: `GetMarketData`, `ExecuteTrade`, `CalculateIndicators`
- **변수**: `CurrentPrice`, `TradingSignal`, `PortfolioValue`

### 한국어 주석 적극 활용
```python
# 업비트 API 호출 제한 관리 - 분당 100회 제한
def ManageAPIRateLimit(self):
    # 마지막 호출 시간 확인
    CurrentTime = time.time()
    # 호출 간격이 0.6초 미만이면 대기
    if CurrentTime - self.LastCallTime < 0.6:
        time.sleep(0.6 - (CurrentTime - self.LastCallTime))
```

### 안정적 코드 구조
- **예외 처리**: 모든 API 호출에 try-except 적용
- **재시도 로직**: 네트워크 오류 시 3회 재시도
- **로깅**: 모든 중요 이벤트 기록
- **검증**: 입력 데이터 유효성 검사

이 프롬프트들을 순서대로 Claude Code에게 전달하면 체계적으로 프로젝트가 진행될 거예요!